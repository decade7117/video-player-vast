<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JW Player dengan VAST Ads</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            border: 1px solid #333;
        }
        
        .embed-mode {
            max-width: none !important;
            width: 100% !important;
            height: 100vh !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            border: none !important;
        }
        
        .player-container {
            position: relative;
            width: 100%;
            background: #000;
            border-radius: 20px 20px 0 0;
            overflow: hidden;
        }
        
        .embed-mode .player-container {
            height: 100vh !important;
            border-radius: 0 !important;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
        }
        
        .embed-mode .video-wrapper {
            padding-top: 0 !important;
            height: 100vh !important;
        }
        
        #jwplayer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .embed-mode #jwplayer {
            position: static;
            height: 100vh !important;
        }
        
        .controls-section {
            padding: 40px;
            background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            font-weight: 700;
        }
        
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #333;
            backdrop-filter: blur(10px);
        }
        
        .section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
            font-size: 14px;
            font-weight: 500;
        }
        
        input[type="text"], input[type="url"], input[type="number"], select, textarea {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0,0,0,0.3);
            border: 2px solid #333;
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(0,0,0,0.5);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .quality-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .embed-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 2px solid #333;
        }
        
        .embed-code {
            background: #0a0a0a;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #00ff88;
            word-break: break-all;
            margin-top: 15px;
            border: 1px solid #333;
        }
        
        .success-message {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            display: none;
            font-weight: 600;
        }
        
        .debug-info {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            margin-top: 25px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            color: #00ff88;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #333;
        }
        
        .sample-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .sample-btn {
            background: rgba(102, 126, 234, 0.2);
            padding: 8px 15px;
            font-size: 12px;
            border-radius: 6px;
            border: 1px solid #667eea;
            color: #667eea;
            transition: all 0.2s ease;
        }
        
        .sample-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            transform: none;
            box-shadow: none;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
            background: #ff4444;
        }
        
        .status-indicator.ready {
            background: #00ff88;
        }
        
        .stored-configs {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #333;
        }
        
        .config-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #444;
        }
        
        .config-name {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .config-details {
            font-size: 12px;
            color: #999;
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .controls-section {
                padding: 25px;
            }
            
            h1 {
                font-size: 26px;
            }
            
            .container {
                border-radius: 0;
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="player-container">
            <div class="video-wrapper">
                <div id="jwplayer"></div>
            </div>
        </div>
        
        <div class="controls-section" id="controlsSection">
            <h1><span class="status-indicator" id="statusIndicator"></span>JW Player dengan VAST Ads</h1>
            
            <div class="section">
                <h3>📹 Video Sources</h3>
                <div class="quality-grid">
                    <div class="input-group">
                        <label for="video480p">Video 480p URL *</label>
                        <input type="url" id="video480p" placeholder="https://example.com/video-480p.mp4">
                    </div>
                    
                    <div class="input-group">
                        <label for="video720p">Video 720p URL</label>
                        <input type="url" id="video720p" placeholder="https://example.com/video-720p.mp4">
                    </div>
                    
                    <div class="input-group">
                        <label for="video1080p">Video 1080p URL</label>
                        <input type="url" id="video1080p" placeholder="https://example.com/video-1080p.mp4">
                    </div>
                </div>
                
                <div class="sample-buttons">
                    <button class="sample-btn" onclick="loadSampleVideo()">Load Sample Video</button>
                    <button class="sample-btn" onclick="testBloggerUrl()">Test Blogger URL</button>
                </div>
            </div>
            
            <div class="section">
                <h3>📺 VAST Advertisement</h3>
                <div class="input-group">
                    <label for="adVideoUrl">Ad Video URL (Direct MP4) *</label>
                    <input type="url" id="adVideoUrl" placeholder="https://example.com/advertisement.mp4">
                </div>
                
                <div class="input-group">
                    <label for="vastXml">Custom VAST XML (Optional)</label>
                    <textarea id="vastXml" placeholder="Paste your VAST XML here or leave empty to auto-generate"></textarea>
                </div>
                
                <div class="sample-buttons">
                    <button class="sample-btn" onclick="loadSampleAd()">Load Sample Ad</button>
                    <button class="sample-btn" onclick="generateVastXml()">Generate VAST XML</button>
                    <button class="sample-btn" onclick="testAdOnly()">Test Ad Only</button>
                </div>
            </div>
            
            <div class="section">
                <h3>⚙️ Player Settings</h3>
                <div class="settings-grid">
                    <div class="input-group">
                        <label for="skipTime">Skip Button Delay (seconds)</label>
                        <input type="number" id="skipTime" value="5" min="0" max="30">
                    </div>
                    
                    <div class="input-group">
                        <label for="adDuration">Ad Duration (seconds)</label>
                        <input type="number" id="adDuration" value="30" min="5" max="120">
                    </div>
                    
                    <div class="input-group">
                        <label for="posterUrl">Poster Image URL</label>
                        <input type="url" id="posterUrl" placeholder="https://example.com/poster.jpg">
                    </div>
                    
                    <div class="input-group">
                        <label for="playerTitle">Video Title</label>
                        <input type="text" id="playerTitle" placeholder="My Video Title">
                    </div>
                    
                    <div class="input-group">
                        <label for="playerWidth">Player Width (px)</label>
                        <input type="number" id="playerWidth" value="854" min="320">
                    </div>
                    
                    <div class="input-group">
                        <label for="playerHeight">Player Height (px)</label>
                        <input type="number" id="playerHeight" value="480" min="240">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>💾 Configuration Management</h3>
                <div class="settings-grid">
                    <div class="input-group">
                        <label for="configName">Configuration Name</label>
                        <input type="text" id="configName" placeholder="My Video Config">
                    </div>
                    <div class="input-group">
                        <label for="savedConfigs">Saved Configurations</label>
                        <select id="savedConfigs">
                            <option value="">Select saved configuration...</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button onclick="saveConfiguration()">💾 Save Config</button>
                    <button onclick="loadConfiguration()">📂 Load Config</button>
                    <button onclick="deleteConfiguration()">🗑️ Delete Config</button>
                    <button onclick="exportConfiguration()">📤 Export Config</button>
                </div>
            </div>
            
            <div class="button-group">
                <button onclick="loadPlayer()">🚀 Load Player</button>
                <button onclick="testFullSetup()">🧪 Test Complete Setup</button>
                <button onclick="generateEmbed()">📋 Generate Embed</button>
                <button onclick="clearDebug()">🧹 Clear Debug</button>
            </div>
            
            <div id="debugInfo" class="debug-info">
                <strong>🔍 Debug Console</strong><br>
                Ready to load player...
            </div>
            
            <div id="embedSection" class="embed-section" style="display: none;">
                <h3 style="margin-bottom: 15px;">📋 Embed Code</h3>
                <div id="embedCode" class="embed-code"></div>
                <div class="button-group">
                    <button onclick="copyEmbed()">📋 Copy Embed Code</button>
                    <button onclick="previewEmbed()">👁️ Preview Embed</button>
                </div>
                <div id="successMessage" class="success-message">Embed code berhasil disalin ke clipboard!</div>
            </div>
            
            <div id="storedConfigs" class="stored-configs" style="display: none;">
                <h3>💾 Stored Configurations</h3>
                <div id="configsList"></div>
            </div>
        </div>
    </div>
    
    <!-- JW Player Script -->
    <script src="https://cdn.jwplayer.com/libraries/KB5zFt7A.js"></script>
    
    <script>
        let jwPlayerInstance;
        let currentConfig = {};
        let isEmbedMode = false;
        let playerReady = false;
        
        // Storage functions
        const storage = {
            save: function(key, data) {
                try {
                    const storage = {};
                    const existingData = this.get('jwplayer_configs') || {};
                    existingData[key] = data;
                    // Store in memory (artifact limitation)
                    window.jwPlayerConfigs = existingData;
                    return true;
                } catch (e) {
                    debugLog('Storage save error: ' + e.message);
                    return false;
                }
            },
            
            get: function(key) {
                try {
                    return window.jwPlayerConfigs || {};
                } catch (e) {
                    debugLog('Storage get error: ' + e.message);
                    return {};
                }
            },
            
            remove: function(key) {
                try {
                    const data = this.get('jwplayer_configs');
                    if (data && data[key]) {
                        delete data[key];
                        window.jwPlayerConfigs = data;
                        return true;
                    }
                    return false;
                } catch (e) {
                    debugLog('Storage remove error: ' + e.message);
                    return false;
                }
            }
        };
        
        // Debug function
        function debugLog(message) {
            const debugDiv = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<br>[${timestamp}] ${message}`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(message);
        }
        
        function clearDebug() {
            document.getElementById('debugInfo').innerHTML = '<strong>🔍 Debug Console</strong><br>Debug cleared...';
        }
        
        function updateStatus(ready = false) {
            const indicator = document.getElementById('statusIndicator');
            indicator.className = 'status-indicator' + (ready ? ' ready' : '');
        }
        
        // Process Blogger URLs
        function processBloggerUrl(url) {
            debugLog('Processing URL: ' + url);
            
            if (url.includes('blogger.com/video.g')) {
                try {
                    const urlObj = new URL(url);
                    
                    // Add parameters for better compatibility
                    if (!urlObj.searchParams.has('itag')) {
                        urlObj.searchParams.set('itag', '18'); // MP4 format
                    }
                    
                    // Add CORS headers bypass
                    urlObj.searchParams.set('source', 'fallback');
                    
                    const processedUrl = urlObj.toString();
                    debugLog('Processed Blogger URL: ' + processedUrl);
                    return processedUrl;
                } catch (e) {
                    debugLog('Error processing Blogger URL: ' + e.message);
                    return url;
                }
            }
            
            return url;
        }
        
        // Build video sources
        function buildVideoSources() {
            const video480p = document.getElementById('video480p').value.trim();
            const video720p = document.getElementById('video720p').value.trim();
            const video1080p = document.getElementById('video1080p').value.trim();
            
            const sources = [];
            
            if (video1080p) {
                sources.push({
                    file: processBloggerUrl(video1080p),
                    label: '1080p',
                    default: true
                });
            }
            
            if (video720p) {
                sources.push({
                    file: processBloggerUrl(video720p),
                    label: '720p',
                    default: !video1080p
                });
            }
            
            if (video480p) {
                sources.push({
                    file: processBloggerUrl(video480p),
                    label: '480p',
                    default: !video720p && !video1080p
                });
            }
            
            debugLog(`Built ${sources.length} video sources`);
            return sources;
        }
        
        // Create VAST XML
        function createVastXml(adUrl, duration = 30, skipOffset = 5) {
            const vastXml = `<?xml version="1.0" encoding="UTF-8"?>
<VAST version="3.0">
    <Ad id="preroll-ad-${Date.now()}">
        <InLine>
            <AdSystem version="1.0"><![CDATA[JW Player Custom]]></AdSystem>
            <AdTitle><![CDATA[Pre-roll Advertisement]]></AdTitle>
            <Description><![CDATA[Advertisement]]></Description>
            <Impression><![CDATA[about:blank]]></Impression>
            <Creatives>
                <Creative id="creative-${Date.now()}" sequence="1">
                    <Linear skipoffset="00:00:${skipOffset.toString().padStart(2, '0')}">
                        <Duration>00:00:${duration.toString().padStart(2, '0')}</Duration>
                        <MediaFiles>
                            <MediaFile delivery="progressive" type="video/mp4" width="854" height="480">
                                <![CDATA[${adUrl}]]>
                            </MediaFile>
                        </MediaFiles>
                        <VideoClicks>
                            <ClickThrough><![CDATA[about:blank]]></ClickThrough>
                        </VideoClicks>
                        <TrackingEvents>
                            <Tracking event="start"><![CDATA[about:blank]]></Tracking>
                            <Tracking event="firstQuartile"><![CDATA[about:blank]]></Tracking>
                            <Tracking event="midpoint"><![CDATA[about:blank]]></Tracking>
                            <Tracking event="thirdQuartile"><![CDATA[about:blank]]></Tracking>
                            <Tracking event="complete"><![CDATA[about:blank]]></Tracking>
                            <Tracking event="skip"><![CDATA[about:blank]]></Tracking>
                        </TrackingEvents>
                    </Linear>
                </Creative>
            </Creatives>
        </InLine>
    </Ad>
</VAST>`;
            
            debugLog('Created VAST XML for ad: ' + adUrl);
            return vastXml;
        }
        
        // Load JW Player
        function loadPlayer() {
            debugLog('Loading JW Player...');
            
            const sources = buildVideoSources();
            const adVideoUrl = document.getElementById('adVideoUrl').value.trim();
            const posterUrl = document.getElementById('posterUrl').value.trim();
            const playerTitle = document.getElementById('playerTitle').value.trim();
            const skipTime = parseInt(document.getElementById('skipTime').value) || 5;
            const adDuration = parseInt(document.getElementById('adDuration').value) || 30;
            
            if (sources.length === 0) {
                alert('Masukkan setidaknya satu URL video!');
                return;
            }
            
            // Destroy existing player
            if (jwPlayerInstance) {
                try {
                    jwPlayerInstance.remove();
                    debugLog('Previous player removed');
                } catch (e) {
                    debugLog('Error removing previous player: ' + e.message);
                }
            }
            
            // JW Player configuration
            const config = {
                playlist: [{
                    sources: sources,
                    image: posterUrl || undefined,
                    title: playerTitle || 'Video Player',
                    description: 'Powered by JW Player with VAST Ads'
                }],
                width: '100%',
                height: '100%',
                autostart: false,
                mute: false,
                controls: true,
                displaytitle: true,
                displaydescription: false,
                abouttext: 'JW Player',
                aboutlink: 'https://jwplayer.com',
                skin: {
                    name: 'glow'
                },
                logo: {
                    hide: true
                },
                captions: {
                    color: '#ffffff',
                    fontSize: 16,
                    backgroundOpacity: 75
                }
            };
            
            // Add VAST advertising if ad URL provided
            if (adVideoUrl) {
                debugLog('Adding VAST advertising...');
                
                let vastContent;
                const customVast = document.getElementById('vastXml').value.trim();
                
                if (customVast) {
                    vastContent = customVast;
                    debugLog('Using custom VAST XML');
                } else {
                    vastContent = createVastXml(adVideoUrl, adDuration, skipTime);
                    debugLog('Generated VAST XML automatically');
                }
                
                // Create VAST data URL
                const vastBlob = new Blob([vastContent], { type: 'text/xml' });
                const vastUrl = URL.createObjectURL(vastBlob);
                
                config.advertising = {
                    client: 'vast',
                    schedule: {
                        'adbreak1': {
                            offset: 'pre',
                            tag: vastUrl
                        }
                    },
                    skipoffset: skipTime,
                    admessage: 'Advertisement - Video will resume in xx seconds',
                    skipmessage: 'Skip ad',
                    skiptext: 'Skip'
                };
                
                debugLog('VAST advertising configured');
            }
            
            // Store current config
            currentConfig = {
                sources: sources,
                adUrl: adVideoUrl,
                posterUrl: posterUrl,
                title: playerTitle,
                skipTime: skipTime,
                adDuration: adDuration,
                timestamp: new Date().toISOString()
            };
            
            try {
                // Initialize JW Player
                jwPlayerInstance = jwplayer('jwplayer').setup(config);
                
                // Add event listeners
                jwPlayerInstance.on('ready', function() {
                    debugLog('✅ JW Player ready');
                    playerReady = true;
                    updateStatus(true);
                });
                
                jwPlayerInstance.on('play', function() {
                    debugLog('▶️ Video playback started');
                });
                
                jwPlayerInstance.on('pause', function() {
                    debugLog('⏸️ Video playback paused');
                });
                
                jwPlayerInstance.on('complete', function() {
                    debugLog('✅ Video playback completed');
                });
                
                jwPlayerInstance.on('error', function(e) {
                    debugLog('❌ Player error: ' + JSON.stringify(e));
                });
                
                // Ad event listeners
                jwPlayerInstance.on('adRequest', function() {
                    debugLog('📺 Ad requested');
                });
                
                jwPlayerInstance.on('adStarted', function() {
                    debugLog('📺 Ad playback started');
                });
                
                jwPlayerInstance.on('adComplete', function() {
                    debugLog('✅ Ad playback completed');
                });
                
                jwPlayerInstance.on('adSkipped', function() {
                    debugLog('⏭️ Ad was skipped');
                });
                
                jwPlayerInstance.on('adError', function(e) {
                    debugLog('❌ Ad error: ' + JSON.stringify(e));
                });
                
                debugLog('🚀 JW Player initialized successfully');
                
            } catch (error) {
                debugLog('❌ Error initializing JW Player: ' + error.message);
                console.error('JW Player Error:', error);
            }
        }
        
        // Sample functions
        function loadSampleVideo() {
            document.getElementById('video480p').value = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
            document.getElementById('video720p').value = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4';
            document.getElementById('playerTitle').value = 'Sample Test Video';
            debugLog('Sample video URLs loaded');
        }
        
        function testBloggerUrl() {
            const bloggerUrl = 'https://www.blogger.com/video.g?token=AD6v5dwg4mybTaq_2Ha1nHzuZGxpQVwVFP8uEVYL2CNbSKud5QeFtHneCCf3p05D084b3ADuBZGnV3mTx7ZGoJMxcPi7AEeh0hhuefbgz6joqhdWYeVcJoAkDQBj2OJPRRwISQHIbj8';
            document.getElementById('video480p').value = bloggerUrl;
            document.getElementById('playerTitle').value = 'Blogger Video Test';
            debugLog('Blogger test URL loaded');
        }
        
        function loadSampleAd() {
            document.getElementById('adVideoUrl').value = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4';
            debugLog('Sample ad URL loaded');
        }
        
        function generateVastXml() {
            const adUrl = document.getElementById('adVideoUrl').value.trim();
            const duration = parseInt(document.getElementById('adDuration').value) || 30;
            const skipTime = parseInt(document.getElementById('skipTime').value) || 5;
            
            if (!adUrl) {
                alert('Masukkan Ad Video URL terlebih dahulu!');
                return;
            }
            
            const vastXml = createVastXml(adUrl, duration, skipTime);
            document.getElementById('vastXml').value = vastXml;
            debugLog('VAST XML generated and populated');
        }
        
        function testAdOnly() {
            // Create minimal video for ad testing
            document.getElementById('video480p').value = 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAABhJtZGF0';
            document.getElementById('playerTitle').value = 'Ad Test';
            
            if (!document.getElementById('adVideoUrl').value.trim()) {
                loadSampleAd();
            }
            
            loadPlayer();
            debugLog('
